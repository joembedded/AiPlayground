<!DOCTYPE html>
<html lang="de-DE">

<head>
    <!-- WICHTIG: http://localhost/wrk/ai/playground/sw/minichat.html  -->
    <!-- WICHTIG: IconListe: https://icons.getbootstrap.com/#icons -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MiniChat - Moderner Chat mit KI und Sprachunterstützung">
    <meta name="author" content="JoEmbedded.de">
    <meta name="theme-color" content="#4CAF50">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="MiniChat" />
    <meta property="og:description" content="AI Playground MiniChat App - (C)JoEmbedded.de" />
    <meta property="og:image" content="https://joembedded.de/x3/minichat/sw/static/preview512.png" />
    <meta property="og:image" content="https://joembedded.de/x3/minichat/sw/static/preview1024x768.png" />

    <!-- PWA Manifest -->
    <!-- <link rel="manifest" href="manifest.webmanifest"> -->

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="./static/favicon.ico">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="./static/icons/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./css/minichat.css">

    <title>MiniChat - Intelligenter Chat mit Sprachsteuerung</title>

    <!-- Scripts -->
    <script src="./js/minichat.js" type="module" defer></script>
</head>

<body>
    <!-- Login Dialog -->
    <dialog id="credentials">
        <h2 id="credentials-title" >Anmeldung</h2>
        <form id="login-form" novalidate>
            <label for="input-user">Benutzer:</label>
            <input type="text" id="input-user" name="username" placeholder="Benutzername"  minlength="6"
                maxlength="32" autocomplete="username" required />

            <label for="input-password">
                <input type="checkbox" id="show-password"
                    onchange="document.getElementById('input-password').type = this.checked ? 'text' : 'password'" />
                Passwort:
            </label>
            <input type="password" id="input-password" name="password" placeholder="Passwort" 
                minlength="8" maxlength="32" autocomplete="current-password" required />

            <div id="login-error" role="alert"></div>
            <button type="submit" id="btn-login">
                <i class="bi bi-box-arrow-in-right"></i> Anmelden
            </button>
            <p><small><i class="bi bi-cookie"></i>&nbsp; 'Anmelden' hinterlegt einen Cookie (technisch notwendig, das Passwort wird von der App nicht gespeichert)</small></p>
            <a href="#" id="loginInfoLink" class="dialog-info-link" role="button">
                <i class="bi bi-info-circle-fill"></i> Über MiniChat
            </a>
        </form>
    </dialog>
    <!-- Info Dialog -->
    <dialog id="infoDialog">
        <h2 id="info-title">Info</h2>
        <div id="infoContent">
            <p>
                <strong>MiniChat</strong> - 
                Chat-Client-Framework für KI mit Audio-Voice-Unterstützung in HTML/JS
                mit darunterligendem PHP-Engine (für OpenAI, etc...).
            </p>
            <ul>
                <li>Sicheres Login</li>
                <li>DSGVO konform (PII nur auf Server)</li>
                <li>Leicht als komfortabler Bot einsetzbar</li>
            </ul>
            <p>Version: <span id="infoVersion">V0.0x / xx.xx.2026</span></p>
            <p><small>&copy; JoEmbedded.de</small></p>
        </div>
        <button id="infoCloseBtn">
            <i class="bi bi-x-circle"></i> Schließen
        </button>
    </dialog>
    <!-- Overlay für Sidebar -->
    <div id="overlay"></div>

    <!-- Navigation Sidebar -->
    <nav id="sidebar" role="navigation">
        <header>
            <h2>
                <button id="sidebar-close" title="Menü schließen">
                    <i class="bi bi-x-circle"></i>
                </button>
                Hauptmenü
            </h2>
        </header>

        <ul>
            <li>
                <a href="#" id="menuInfo" role="button">
                    <i class="bi bi-info-circle-fill"></i>
                    <span>Info</span>
                </a>
            </li>
            <li>
                <a href="#" id="menuLogout" role="button">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>User '<strong id="userName">USER</strong>' abmelden</span>
                </a>
            </li>
            <li>
                <fieldset>
                    <legend>
                        <i class="bi bi-mic-fill"></i>
                        Rauschunterdrückung
                    </legend>
                    <i id="microOnOff">Mikro ist AUS</i>
                    <label for="threshold">
                        Threshold: <span id="thresholdFeedback">2.0</span>
                    </label>
                    <input disabled type="range" id="threshold" min="0" max="5" value="2" step="0.1" />

                    <label for="autoThreshChk">
                        <input id="autoThreshChk" type="checkbox" role="switch" checked />
                        Auto Threshold
                    </label>

                    <canvas class="visualizer" width="200" height="20"></canvas>
                </fieldset>
            </li>
            <li>
                <fieldset>
                    <legend>
                        <i class="bi bi-activity"></i>
                        Pausenerkennung
                    </legend>
                    <label for="maxpause">
                        Max Pause (ms): <span id="maxpauseFeedback">1000</span>
                    </label>
                    <input disabled type="range" id="maxpause" min="200" max="2200" value="1000" step="50" />
                </fieldset>
            </li>
            <li>
                <fieldset>
                    <legend>
                        <i class="bi bi-soundwave"></i>
                        Audio-Optionen
                    </legend>
                    <label for="autoPostChk">
                        <input id="autoPostChk" type="checkbox" role="switch" checked/>
                        Automatisch senden
                    </label>
                    <label for="autoPlayChk">
                        <input id="autoPlayChk" type="checkbox" role="switch" checked />
                        Mikrofon AN lassen
                    </label>
                </fieldset>
            </li>
            <!-- Weitere <li></li>... -->
        </ul>
    </nav>

    <!-- App Header -->
    <header role="banner">
        <button id="menu-toggle" title="Menü öffnen">
            <i class="bi bi-list"></i>
        </button>
        <h1>MiniChat </h1>
        <div class="header-stats">
            <!-- <div class="stat-line">Credits: <span id="credits-value">0</span></div> -->
            <div class="stat-line">Used Tokens:<div id="tokens-value">0</div></div>
        </div>
    </header>

    <!-- Chat Verlauf -->
    <main id="chat-verlauf" role="main"></main>

    <!-- Debug Bereich (optional) -->
    <aside class="dbg" hidden>
        <div class="dbgInfoDiv">
            <span id="dbginfo">Idle</span> -
            <span id="audioStatus">Ready</span>
        </div>
        <div class="audio-controls">
            <audio class="stdplayer" controls></audio>
            <audio id="audioPlayer" controls></audio>
        </div>
        <div class="terminal" id="dbgTerminal" role="log"></div>
    </aside>

    <!-- Eingabebereich -->
    <section id="eingabe-bereich" role="region">
        <label for="text-eingabe" class="visually-hidden">Ihre Nachricht</label>
        <textarea id="text-eingabe" rows="3" placeholder="Micro einschalten oder tippe deine Nachricht..."></textarea>
        <span id="eingabe-hinweis" class="visually-hidden">
            Drücken Sie Enter zum Senden oder nutzen Sie den Senden-Button
        </span>

        <div class="button-group">
            <button id="btn-senden" type="button" title="Nachricht senden (Enter)" disabled="disabled">
                <i id="senden-button-glyph" class="bi bi-send-fill"></i>
            </button>
            <button id="btn-micro" type="button" class="micro" title="Mikrofon ein/aus" disabled="disabled">
                <i id="micro-button-glyph" class="bi bi-mic-mute-fill"></i>
            </button>
        </div>
    </section>

    <!-- Footer -->
    <footer role="contentinfo">
        <span id="chat-status" role="status">Bereit</span>
        <small>(C) JoEmbedded.de</small>
    </footer>
</body>

</html>